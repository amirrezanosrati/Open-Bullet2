name: OB2 Simplest Solution

on:
  workflow_dispatch

jobs:
  run-ob2-simple:
    runs-on: ubuntu-latest

    steps:
    - name: Run OB2 with Docker Compose
      run: |
        sudo apt-get update
        sudo apt-get install -y docker.io
        sudo systemctl start docker
        
        # Ø§Ø³ØªÙØ§Ø¯Ù‡ Ø§Ø² docker run Ø³Ø§Ø¯Ù‡
        docker run -d \
          --name ob2 \
          -p 8080:8080 \
          mrinjamul/openbullet2:latest
        
        sleep 30
        docker ps

    - name: Setup Ngrok
      run: |
        wget -q https://bin.equinox.io/c/bNyj1mQVY4c/ngrok-v3-stable-linux-amd64.tgz
        tar -xzf ngrok-v3-stable-linux-amd64.tgz
        ./ngrok authtoken ${{ secrets.NGROK_AUTH_TOKEN }}
        ./ngrok http 8080 &
        sleep 10

    - name: Show URL
      run: |
        URL=$(curl -s http://localhost:4040/api/tunnels | grep -o 'https://[^"]*' | head -1)
        echo "ğŸŒ Your OpenBullet2: $URL"
        echo "ğŸ”‘ admin/admin"

    - name: Wait
      run: |
        sleep 14400
