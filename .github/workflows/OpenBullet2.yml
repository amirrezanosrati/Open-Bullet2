name: OB2 Super Simple

on:
  workflow_dispatch

jobs:
  run-ob2:
    runs-on: windows-latest
    timeout-minutes: 120

    steps:
    - name: Download and Run
      run: |
        # دانلود اکسپلورر از ریلیز
        iwr https://github.com/openbullet/OpenBullet2/releases/latest/download/OpenBullet2.Explorer.zip -outfile ob2.zip
        Expand-Archive ob2.zip -Force
        cd OpenBullet2.Explorer
        .\OpenBullet2.Explorer.exe &
        sleep 30

    - name: Setup Ngrok
      run: |
        iwr https://bin.equinox.io/c/bNyj1mQVY4c/ngrok-v3-stable-windows-amd64.zip -outfile ngrok.zip
        Expand-Archive ngrok.zip -Force
        .\ngrok.exe authtoken ${{ secrets.NGROK_AUTH_TOKEN }}
        .\ngrok.exe http 8080 &
        sleep 20

    - name: Show Info
      run: |
        $url = (irm http://localhost:4040/api/tunnels).tunnels[0].public_url
        write-host "OpenBullet2 Ready: $url"

    - name: Keep alive
      run: |
        sleep 3600
