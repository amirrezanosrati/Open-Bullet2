name: Direct OB2 Download

on:
  workflow_dispatch

jobs:
  run-ob2-direct:
    runs-on: ubuntu-latest

    steps:
    - name: Download OB2 release
      run: |
        # Ø¯Ø§Ù†Ù„ÙˆØ¯ Ø¢Ø®Ø±ÛŒÙ† Ù†Ø³Ø®Ù‡ Ø§Ø² GitHub Releases
        wget $(curl -s https://api.github.com/repos/openbullet/OpenBullet2/releases/latest | grep browser_download_url | grep linux | cut -d'"' -f4) -O ob2.zip
        unzip ob2.zip -d ob2
        chmod +x ob2/OpenBullet2

    - name: Install dependencies
      run: |
        sudo apt-get update
        sudo apt-get install -y libgdiplus

    - name: Run OB2
      run: |
        cd ob2
        ./OpenBullet2 --urls "http://0.0.0.0:8080" &
        sleep 20

    - name: Setup Ngrok
      run: |
        wget -q https://bin.equinox.io/c/bNyj1mQVY4c/ngrok-v3-stable-linux-amd64.tgz
        tar -xzf ngrok-v3-stable-linux-amd64.tgz
        ./ngrok authtoken ${{ secrets.NGROK_AUTH_TOKEN }}
        ./ngrok http 8080 > /dev/null 2>&1 &
        sleep 10

    - name: Show URL
      run: |
        URL=$(curl -s http://localhost:4040/api/tunnels | grep -o 'https://[^"]*' | head -1)
        echo "ğŸŒ Your OB2: $URL"
        echo "Password: admin"

    - name: Wait
      run: |
        sleep 3600
