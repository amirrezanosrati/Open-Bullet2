name: OB2 with Alternative Ngrok

on:
  workflow_dispatch

jobs:
  run-ob2-ngrok-alt:
    runs-on: ubuntu-latest

    steps:
    - name: Run OB2
      run: |
        sudo apt-get install -y dotnet-sdk-6.0
        git clone https://github.com/openbullet/OpenBullet2.git
        cd OpenBullet2
        dotnet run --project OpenBullet2.Web --urls "http://0.0.0.0:8080" &
        sleep 60

    - name: Try different Ngrok regions
      run: |
        wget -q https://bin.equinox.io/c/bNyj1mQVY4c/ngrok-v3-stable-linux-amd64.tgz
        tar -xzf ngrok-v3-stable-linux-amd64.tgz
        
        # ØªØ³Øª regionâ€ŒÙ‡Ø§ÛŒ Ù…Ø®ØªÙ„Ù
        regions=("us" "eu" "ap" "au" "sa" "jp" "in")
        
        for region in "${regions[@]}"; do
          echo "Trying region: $region"
          ./ngrok authtoken ${{ secrets.NGROK_AUTH_TOKEN }}
          ./ngrok http 8080 --region $region > ngrok_$region.log 2>&1 &
          sleep 20
          
          if curl -s http://localhost:4040/api/tunnels > /dev/null; then
            url=$(curl -s http://localhost:4040/api/tunnels | grep -o 'https://[^"]*' | head -1)
            echo "âœ… Success with region: $region"
            echo "ğŸŒ URL: $url"
            break
          else
            echo "âŒ Failed with region: $region"
            pkill ngrok
          fi
        done

    - name: Wait
      run: |
        sleep 7200
