name: OB2 Direct Run

on:
  workflow_dispatch

jobs:
  run-ob2-direct:
    runs-on: ubuntu-latest

    steps:
    - name: Install .NET
      run: |
        sudo apt-get update
        sudo apt-get install -y dotnet-sdk-6.0

    - name: Clone and run
      run: |
        git clone https://github.com/openbullet/OpenBullet2.git
        cd OpenBullet2
        dotnet run --project OpenBullet2.Web --urls "http://0.0.0.0:8080" &
        sleep 60

    - name: Setup Ngrok
      run: |
        wget -q https://bin.equinox.io/c/bNyj1mQVY4c/ngrok-v3-stable-linux-amd64.tgz
        tar -xzf ngrok-v3-stable-linux-amd64.tgz
        ./ngrok authtoken ${{ secrets.NGROK_AUTH_TOKEN }}
        ./ngrok http 8080 &
        sleep 20

    - name: Get URL
      run: |
        url=$(curl -s http://localhost:4040/api/tunnels | grep -o 'https://[^"]*' | head -1)
        echo "✅ OpenBullet2 Ready: $url"

    - name: Keep running
      run: |
        # نگه داشتن برای 2 ساعت
        sleep 7200
